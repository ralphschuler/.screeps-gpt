---
name: Copilot Email Triage

on:
  workflow_dispatch:
    inputs:
      from:
        description: 'Sender email address'
        required: true
        type: string
      to:
        description: 'Recipient email address'
        required: true
        type: string
      subject:
        description: 'Email subject'
        required: true
        type: string
      body:
        description: 'Email body'
        required: true
        type: string

permissions:
  contents: read
  issues: write

concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: false

jobs:
  triage:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    steps:
      - name: Check out repository
        uses: actions/checkout@v6
      - name: Run Copilot email triage
        uses: ./.github/actions/codex-exec
        env:
          REPO_NAME: ${{ github.repository }}
          EVENT_URL: >-
            https://github.com/${{ github.repository }}/actions/runs/${{
            github.run_id }}
          EMAIL_SUBJECT: >-
            ${{ inputs.subject }}
          EMAIL_FROM: >-
            ${{ inputs.from }}
          EMAIL_TO: >-
            ${{ inputs.to }}
          EMAIL_BODY: >-
            ${{ inputs.body }}
        with:
          force-response: true
          codex-token: ${{ secrets.OPENAI_API_KEY }}
          prompt-path: .github/copilot/prompts/email-triage
          output-path: >-
            reports/copilot/email-triage-${{ github.run_id }}.log
