---
name: Copilot Daily Todo Prioritization

on:
  schedule:
    - cron: "0 9 * * *"
  workflow_dispatch:

permissions:
  contents: read
  issues: write

concurrency:
  group: copilot-todo-daily
  cancel-in-progress: false

jobs:
  prioritize:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    steps:
      - name: Check out repository
        uses: actions/checkout@v6
      - name: Run Copilot daily Todo prioritization
        uses: ./.github/actions/copilot-exec
        env:
          REPO_NAME: "${{ github.repository }}"
          RUN_ID: "${{ github.run_id }}"
          RUN_URL: >-
            https://github.com/${{ github.repository }}/actions/runs/${{
            github.run_id }}
          SCREEPS_TOKEN: ${{ secrets.SCREEPS_TOKEN }}
          SCREEPS_SHARD: ${{ vars.SCREEPS_SHARD || 'shard1' }}
        with:
          force-response: true
          copilot-token: ${{ secrets.COPILOT_TOKEN }}
          prompt-path: >-
            .github/copilot/prompts/todo-daily-prioritization
          output-path: >-
            reports/copilot/todo-daily-prioritization-${{
            github.run_id }}.log
          additional-mcp-config: '@.github/mcp/all-servers.json'
