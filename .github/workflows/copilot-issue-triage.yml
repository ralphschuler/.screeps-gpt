name: Copilot Issue Triage

on:
  issues:
    types:
      - opened

permissions:
  contents: read
  issues: write

jobs:
  triage:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4
      - name: Run Copilot issue triage
        uses: ./.github/actions/copilot-exec
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          prompt-path: .github/copilot/prompts/issue-triage.md
          output-path: reports/copilot/issue-triage-${{ github.event.issue.number }}.log
          substitutions: |
            {
              "REPO_NAME": "${{ github.repository }}",
              "ISSUE_NUMBER": "${{ github.event.issue.number }}",
              "ISSUE_TITLE": ${{ toJSON(github.event.issue.title) }},
              "ISSUE_BODY": ${{ toJSON(github.event.issue.body || '') }},
              "ISSUE_HTML_URL": ${{ toJSON(github.event.issue.html_url) }},
              "ISSUE_AUTHOR": ${{ toJSON(github.event.issue.user.login) }}
            }
          model: gpt-4o-mini
